<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>Blood Transfusion Calculator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
.donor-group {
  background-color: #f1f3f5;
  border: 1px solid #ced4da;
  border-radius: 6px;
  padding: 12px;
  margin-top: 12px;
  box-shadow: 1px 1px 2px rgba(0,0,0,0.03);
  position: relative;
}

.remove-btn {
  position: absolute;
  top: 8px;
  right: 8px;
  background: #dee2e6;
  color: #495057;
  border: none;
  border-radius: 50%;
  width: 24px;
  height: 24px;
  font-size: 16px;
  line-height: 24px;
  text-align: center;
  cursor: pointer;
}
.remove-btn:hover {
  background: #ced4da;
}

.donor-group input,
.donor-group select {
  box-sizing: border-box;
  width: 100%;
  max-width: 100%;
  padding: 8px 10px;
}
}
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
      padding: 16px;
      margin: 0;
      background-color: #f8f9fa;
    }

    h1.title {
      text-align: center;
      font-size: 1.6rem;
      margin-bottom: 20px;
      color: #333;
    }
    .tabs {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      border-bottom: 1px solid #dee2e6;
      margin-bottom: 20px;
    }
    .tab {
      flex: 1;
      text-align: center;
      padding: 12px 0;
      cursor: pointer;
      background: #e9ecef;
      border: 1px solid #dee2e6;
      border-bottom: none;
      font-size: 0.95rem;
    }
    .tab.active {
      background: #fff;
      font-weight: 600;
    }
    .tab-content {
      display: none;
      background: #fff;
      padding: 16px;
      border: 1px solid #dee2e6;
      border-radius: 4px;
    }
    .tab-content.active {
      display: block;
    }
    label {
      display: block;
      font-size: 0.9rem;
      margin-top: 12px;
      color: #212529;
    }
    input[type="number"], select {
      display: block;
      width: 100%;
      max-width: 300px;
      padding: 8px;
      margin-top: 4px;
      font-size: 0.9rem;
      border: 1px solid #ced4da;
      border-radius: 4px;
    }
    button {
      margin-top: 16px;
      margin-right: 8px;
      padding: 10px 16px;
      font-size: 0.9rem;
      background: #007bff;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    button:hover {
      background: #0056b3;
    }
    .result {
      margin-top: 20px;
      font-weight: bold;
      color: #212529;
      font-size: 1rem;
    }
    .formula {
      font-size: 0.9rem;
      color: #495057;
      margin-top: 20px;
      padding: 10px;
      background-color: #f8f9fa;
      border-left: 4px solid #adb5bd;
      border-radius: 4px;
    }
    .math {
      font-family: 'Cambria Math', 'Times New Roman', serif;
      font-size: 1rem;
    }
  </style>
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>
<body>
  
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
  <h1 class="title" style="margin: 0;">Blood Transfusion Calculator</h1>
  <div style="width: 100px;">
    <img src="img_2742.png" alt="고양이" style="
      display: block;
      width: 120%;
      max-height: 100px;
      object-fit: cover;
      border-radius: 8px;
      box-shadow: inset 0 0 4px 2px rgba(255,255,255,0.3);
    ">
  </div>

</div>
  <div class="tabs">
    <div class="tab active" onclick="openTab('tab1')">수혈 후 HCT</div>
    <div class="tab" onclick="openTab('tab2')">수혈 효율</div>
  </div>
  <div class="tab-content active" id="tab1">
    <label>수혈묘 체중 (kg)
      <input type="number" id="weight" placeholder="예: 2.8">
    </label>
    <label>수혈 전 HCT (%)
      <input type="number" id="preHct" placeholder="예: 13.1">
    </label>
    <h3 style="margin-top:20px">수혈 혈액 정보</h3>
    <div id="donorInputs">
      <div class="donor-group">
        <label>공혈 HCT (%)
          <input type="number" class="donorHct" placeholder="예: 20.9">
          <div class="donor-note">* 미입력 시 기본값 30%로 계산됩니다.</div>
        </label>
        <label>수혈량 (ml)
          <input type="number" class="donorVol" placeholder="예: 67">
        </label>
      </div>
    </div>
    <button onclick="addDonorInput()">+ 혈액 추가</button>
    <button onclick="calculate()">계산하기</button>
    <div class="result" id="result"></div>
    <div class="formula">
      <strong>계산식:</strong><br>
      <span class="math">
        \[ \Delta \text{HCT} = \frac{\sum (\text{공혈 HCT} \times \text{수혈량})}{\text{수혈묘 체중} \times 0.66} \]<br>
        \[ \text{수혈 후 HCT} = \text{수혈 전 HCT} + \Delta \text{HCT} \]
      </span>
    </div>
  </div>
  <div class="tab-content" id="tab2">
    <label>수혈묘 체중 (kg)
      <input type="number" id="eff-weight" placeholder="예: 3.5">
    </label>
    <label>수혈 전 HCT (%)
      <input type="number" id="eff-preHct" placeholder="예: 10.2">
    </label>
    <label>수혈 후 HCT (%)
      <input type="number" id="eff-postHct" placeholder="예: 16.1">
    </label>
    <label>수혈량 (ml)
      <input type="number" id="eff-volume" placeholder="예: 60">
    </label>
    <button onclick="calculateEfficiency()">효율 계산</button>
    <div class="result" id="efficiency-result"></div>
    <div class="formula">
      <strong>계산식:</strong><br>
      <span class="math">
        \[ \text{계수} = \frac{\text{수혈량}}{\Delta \text{HCT} \times \text{체중}} \]
      </span><br>
      → 본 탭은 수혈의 효율을 정량적으로 표현하고자 만든 도구입니다. 수혈 효율이라는 수의학적 지표는 실제로는 없으나, 
      임상에서 오른 정도를 직관적으로 파악하기 위한 목적입니다. 수치가 작을수록 같은 수혈량으로 HCT를 더 많이 올렸음을 의미합니다.
    </div>
  </div>

  <script>
    function openTab(tabId) {
      const tabs = document.querySelectorAll('.tab');
      const contents = document.querySelectorAll('.tab-content');
      tabs.forEach(tab => tab.classList.remove('active'));
      contents.forEach(content => content.classList.remove('active'));
      document.querySelector(`.tab[onclick*="${tabId}"]`).classList.add('active');
      document.getElementById(tabId).classList.add('active');
    }

    function addDonorInput() {
      const container = document.getElementById('donorInputs');
      const group = document.createElement('div');
      group.className = 'donor-group';
      group.innerHTML = `
        <label>공혈 HCT (%)
          <input type="number" class="donorHct" placeholder="예: 28.5">
          <div class="donor-note">* 미입력 시 기본값 30%로 계산됩니다.</div>
        </label>
        <label>수혈량 (ml)
          <input type="number" class="donorVol" placeholder="예: 45">
        </label>
      `;
      container.appendChild(group);
    }

    function calculate() {
      const weight = parseFloat(document.getElementById('weight').value);
      const preHct = parseFloat(document.getElementById('preHct').value);
      const donorHcts = document.querySelectorAll('.donorHct');
      const donorVols = document.querySelectorAll('.donorVol');

      if (isNaN(weight) || isNaN(preHct)) {
        document.getElementById('result').textContent = '체중과 수혈 전 HCT를 입력해주세요.';
        return;
      }

      let totalHctVolume = 0;
      for (let i = 0; i < donorVols.length; i++) {
        const vol = parseFloat(donorVols[i].value);
        let hct = parseFloat(donorHcts[i].value);
        if (isNaN(vol)) continue;
        if (isNaN(hct)) hct = 30;
        totalHctVolume += vol * (hct / 100);
      }

      if (totalHctVolume === 0) {
        document.getElementById('result').textContent = '수혈량을 최소 1개 이상 입력해주세요.';
        return;
      }

      const delta = (totalHctVolume / (weight * 0.66));
      const postHct = preHct + delta;
      document.getElementById('result').textContent = `예상 수혈 후 HCT: ${postHct.toFixed(2)}% (상승치: ${delta.toFixed(2)}%)`;
    }

    function calculateEfficiency() {
      const weight = parseFloat(document.getElementById('eff-weight').value);
      const pre = parseFloat(document.getElementById('eff-preHct').value);
      const post = parseFloat(document.getElementById('eff-postHct').value);
      const volume = parseFloat(document.getElementById('eff-volume').value);

      if ([weight, pre, post, volume].some(isNaN)) {
        document.getElementById('efficiency-result').textContent = '모든 항목을 입력해주세요.';
        return;
      }

      const delta = post - pre;
      if (delta <= 0) {
        document.getElementById('efficiency-result').textContent = 'HCT 상승량이 0 이하입니다.';
        return;
      }

      const coeff = volume / (delta * weight);
      document.getElementById('efficiency-result').textContent = `수혈 효율 계수: ${coeff.toFixed(2)}`;
    }

  </script>
</body>
</html>
